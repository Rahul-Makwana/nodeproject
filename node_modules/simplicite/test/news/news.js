import simplicite from '../../dist/esm/simplicite.js';
import fs from 'node:fs';

const app = simplicite.session({
	url: 'https://dev6.dev2.simplicite.io',
	username: 'designer',
	password: '74dcc389bc84d8dd4b89',
	debug: true
});

app.info(`Version: ${simplicite.constants.MODULE_VERSION}`);

app.login().then(async user => {
	app.debug(user);

	const data = new FormData();
	const now = new Date();
	const title = `Test-${now.getTime()}`;
	data.append('title', title);
	data.append('description', `This is a test news dated ${now}`);
	data.append('image', new Blob([ fs.readFileSync('news.jpg') ]), `${title}.jpg`);
	app.debug('Data', data.get('title'), data.get('description'), data.get('image'));

	const res = await app.getExternalObject('NewsAPI').call(null, data);
	app.info(JSON.stringify(res, null, 2));

	return app.logout();
}).then(logout => {
	app.debug(logout);
	app.info('OK');
}).catch(err => {
	app.error(err);
});
