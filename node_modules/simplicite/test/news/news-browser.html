<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>News API test</title>
    <script src="simplicite.min.js"></script>
</head>
<body>
    <form id="news" action="javascript:void(0)">
        <input type="text" name="title" placeholder="News title"/>
        <br/><br/><textarea name="description" placeholder="News content"></textarea>
        <br/><br/><input type="file" name="image"/>
        <br/><br/><button type="button" id="ok">OK</button>
    </form>
    <div id="res" style="font-family: monospace; white-space: pre;"></div>
</body>
<script>
window.addEventListener('load', () => {
    const app = simplicite.session({
        url: 'https://dev6.dev2.simplicite.io',
        username: 'designer',
        password: '74dcc389bc84d8dd4b89',
        debug: true
    });
    app.info(simplicite.constants.MODULE_VERSION);

    app.login().then(user => {
        app.debug('User', user);
        document.getElementById('ok').addEventListener('click', async () => {
            try {
                const data = new FormData(document.getElementById('news'));
                app.debug('Data', data.get('title'), data.get('description'), data.get('image'))

                // External object call
                const res = await app.getExternalObject('NewsAPI').call(null, data);
                /* or simple fetch:
                const response = await fetch(`${app.parameters.url}/api/ext/NewsAPI`, {
                    method: 'post',
                    credentials: 'include',
                    headers: { 'X-Simplicite-Authorization': `Bearer ${user.authtoken}` },
                    body: data
                });
                const res = await response.json();
                */
                app.info('Result', res);
                document.getElementById('res').innerHTML = JSON.stringify(res, null, 4);
            } catch(err) {
                app.error('Error', err);
            }
        })
    });
});
</script>
</html>
